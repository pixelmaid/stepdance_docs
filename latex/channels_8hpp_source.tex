\doxysection{channels.\+hpp}
\hypertarget{channels_8hpp_source}{}\label{channels_8hpp_source}\index{lib/channels.hpp@{lib/channels.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{00001\ \textcolor{preprocessor}{\#include\ "{}arm\_math.h"{}}}
\DoxyCodeLine{00002\ \textcolor{preprocessor}{\#include\ <sys/\_stdint.h>}}
\DoxyCodeLine{00003\ \textcolor{preprocessor}{\#include\ "{}output\_ports.hpp"{}}}
\DoxyCodeLine{00004\ \textcolor{preprocessor}{\#include\ "{}core.hpp"{}}}
\DoxyCodeLine{00005\ }
\DoxyCodeLine{00006\ \textcolor{comment}{/*}}
\DoxyCodeLine{00007\ \textcolor{comment}{Channels\ Module\ of\ the\ StepDance\ Control\ System}}
\DoxyCodeLine{00008\ \textcolor{comment}{}}
\DoxyCodeLine{00009\ \textcolor{comment}{[More\ Details\ to\ be\ Added]}}
\DoxyCodeLine{00010\ \textcolor{comment}{}}
\DoxyCodeLine{00011\ \textcolor{comment}{A\ part\ of\ the\ Mixing\ Metaphors\ Project}}
\DoxyCodeLine{00012\ \textcolor{comment}{(c)\ 2025\ Ilan\ Moyer,\ Jennifer\ Jacobs,\ Devon\ Frost}}
\DoxyCodeLine{00013\ \textcolor{comment}{*/}}
\DoxyCodeLine{00014\ }
\DoxyCodeLine{00015\ \textcolor{preprocessor}{\#ifndef\ channels\_h\ }\textcolor{comment}{//prevent\ importing\ twice}}
\DoxyCodeLine{00016\ \textcolor{preprocessor}{\#define\ channels\_h}}
\DoxyCodeLine{00017\ }
\DoxyCodeLine{00018\ \textcolor{preprocessor}{\#define\ MAX\_NUM\_CHANNELS\ 10\ }\textcolor{comment}{//just\ to\ start\ with,\ until\ we\ need\ more.}}
\DoxyCodeLine{00019\ }
\DoxyCodeLine{00020\ \textcolor{keywordtype}{void}\ run\_all\_registered\_channels();\ \textcolor{comment}{//drives\ all\ registered\ channels\ to\ their\ target\ positions}}
\DoxyCodeLine{00021\ \textcolor{keywordtype}{void}\ activate\_channels();\ \textcolor{comment}{//adds\ channels\ to\ the\ frame\ interrupt\ routine}}
\DoxyCodeLine{00022\ }
\DoxyCodeLine{00023\ }
\DoxyCodeLine{00025\ }
\DoxyCodeLine{00032\ }
\DoxyCodeLine{00033\ \textcolor{keyword}{class\ }Channel\ :\ \textcolor{keyword}{public}\ Plugin\{}
\DoxyCodeLine{00034\ \ \ \textcolor{keyword}{public}:}
\DoxyCodeLine{00035\ \ \ \ \ \textcolor{comment}{//\ Public\ State}}
\DoxyCodeLine{00039\ \ \ \ \ DecimalPosition\ \mbox{\hyperlink{class_channel_a823f52bb234e60643f9b422a084e94f3}{target\_position}};\ \textcolor{comment}{//primary\ target\ position,\ in\ pulses.}}
\DoxyCodeLine{00043\ \ \ \ \ DecimalPosition\ \mbox{\hyperlink{class_channel_a3c96c0b9aee1a6e7d9bb265ccb9c86e7}{current\_position}};\ \textcolor{comment}{//tracks\ the\ current\ position,\ in\ pulses.}}
\DoxyCodeLine{00047\ \ \ \ \ DecimalPosition\ \mbox{\hyperlink{class_channel_afc949cb6c6bbadcc164ab8191e04558c}{filtered\_target\_position}};\ \textcolor{comment}{//\ filtered\ target\ position}}
\DoxyCodeLine{00051\ \ \ \ \ \textcolor{keywordtype}{bool}\ \mbox{\hyperlink{class_channel_a2b370f0b880c356df887b05a55a46b95}{filtering\_on}}\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00052\ }
\DoxyCodeLine{00057\ \ \ \ \ DecimalPosition\ target\_position\_2;\ \textcolor{comment}{//\ secondary\ target\ position,\ used\ for\ coordinate\ transforms.}}
\DoxyCodeLine{00058\ \ \ \ \ float32\_t\ num\_averaging\_samples\ =\ 20;\ \textcolor{comment}{//samples\ in\ the\ averaging\ window}}
\DoxyCodeLine{00059\ \ \ \ \ \textcolor{comment}{//\ BlockPorts}}
\DoxyCodeLine{00060\ \ \ \ \ BlockPort\ input\_target\_position;}
\DoxyCodeLine{00061\ \ \ \ \ BlockPort\ input\_target\_position\_2;}
\DoxyCodeLine{00063\ }
\DoxyCodeLine{00064\ \ \ \ \ \textcolor{comment}{//\ Public\ Methods}}
\DoxyCodeLine{00065\ \ \ \ \ Channel();}
\DoxyCodeLine{00070\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_channel_a395b2f1afe3e1351806fb826e5a23d42}{begin}}();\ \textcolor{comment}{//channel\ with\ no\ output\ port}}
\DoxyCodeLine{00071\ }
\DoxyCodeLine{00077\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_channel_a93505d47732a9a17a97dfb848defadf5}{begin}}(\mbox{\hyperlink{class_output_port}{OutputPort}}*\ target\_output\_port,\ uint8\_t\ output\_signal);}
\DoxyCodeLine{00082\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_channel_ac73f65baf832b880f262e99ad6c79606}{set\_max\_pulse\_rate}}(\textcolor{keywordtype}{float}\ max\_pulses\_per\_sec);\ }
\DoxyCodeLine{00088\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_channel_acfd40d913937c2ef292f9d6b00d9f144}{set\_ratio}}(\textcolor{keywordtype}{float}\ input\_units,\ \textcolor{keywordtype}{float}\ channel\_units\ =\ 1.0);\ \textcolor{comment}{//sets\ the\ transmission\ ratio\ for\ all\ target\ transmissions}}
\DoxyCodeLine{00093\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_channel_a9c0df399ebeba1a09e41b42264d064c7}{set\_upper\_limit}}(DecimalPosition\ upper\_limit\_input\_units);\ \textcolor{comment}{//sets\ the\ upper\ limit,\ using\ input\ (world)\ units.}}
\DoxyCodeLine{00098\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_channel_add939b27aad8cff94b857bcd2895e3e0}{set\_lower\_limit}}(DecimalPosition\ lower\_limit\_input\_units);\ \textcolor{comment}{//sets\ the\ lower\ limit,\ using\ input\ (world)\ units.}}
\DoxyCodeLine{00102\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_channel_a837a7759027b950410e4b8ef18ec863e}{disable\_upper\_limit}}();}
\DoxyCodeLine{00106\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_channel_a28bf6a07b2b7635c85add28b31aeb255}{disable\_lower\_limit}}();}
\DoxyCodeLine{00113\ \ \ \ \ \ \ \textcolor{keyword}{inline}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_channel_a20bf288de296ba9d7c7105f2a66500aa}{disable\_limits}}()\{}
\DoxyCodeLine{00114\ \ \ \ \ \ \ \mbox{\hyperlink{class_channel_a837a7759027b950410e4b8ef18ec863e}{disable\_upper\_limit}}();}
\DoxyCodeLine{00115\ \ \ \ \ \ \ \mbox{\hyperlink{class_channel_a28bf6a07b2b7635c85add28b31aeb255}{disable\_lower\_limit}}();}
\DoxyCodeLine{00116\ \ \ \ \ \}}
\DoxyCodeLine{00120\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_channel_a6d2e75a02a53fc31163409f2c58468ab}{disable}}();}
\DoxyCodeLine{00124\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_channel_a41956c94fe300d0cae25d6040422c9e5}{enable}}();}
\DoxyCodeLine{00129\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_channel_a4752378e65ebfff9ef89f5d5d942d418}{enable\_filtering}}(uint16\_t\ num\_samples\ =\ 20);}
\DoxyCodeLine{00133\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_channel_aebb93ae1a45624307229f2214234b800}{disable\_filtering}}();}
\DoxyCodeLine{00138\ \ \ \ \ int8\_t\ \mbox{\hyperlink{class_channel_a7bfd0c8dbc915af01f2f03633257fbc9}{is\_outside\_limits}}();\ }
\DoxyCodeLine{00145\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_channel_ab493519b6aa6d2bdcdbb34ef72b2c20d}{invert\_output}}();\ }
\DoxyCodeLine{00150\ \ \ \ \ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{class_channel_aabc1e8d3f0563b1b70e8107d2dd7751d}{invert\_output}}(\textcolor{keywordtype}{bool}\ invert);}
\DoxyCodeLine{00151\ \ \ }
\DoxyCodeLine{00152\ \ \ \ }
\DoxyCodeLine{00157\ \ \ \ \textcolor{keywordtype}{void}\ enroll(RPC\ *rpc,\ \textcolor{keyword}{const}\ String\&\ instance\_name);\ \ \ \ \ }
\DoxyCodeLine{00158\ \ \ \ \textcolor{keywordtype}{void}\ run();\ \textcolor{comment}{//Drives\ the\ current\ position\ to\ the\ target\ position\ by\ one\ pulse,\ and\ generates\ a\ signal}}
\DoxyCodeLine{00160\ \ \ }
\DoxyCodeLine{00161\ \ \ }
\DoxyCodeLine{00162\ \ \ \textcolor{keyword}{private}:}
\DoxyCodeLine{00163\ \ \ \ \ \textcolor{comment}{//\ Constants}}
\DoxyCodeLine{00164\ \ \ \ \ \textcolor{keyword}{const}\ uint32\_t\ ACCUMULATOR\_THRESHOLD\ =\ 1000000;}
\DoxyCodeLine{00165\ \ \ \ \ \textcolor{keyword}{const}\ uint32\_t\ PULSE\_MAX\_RATE\ =\ 1000000\ /\ CORE\_FRAME\_PERIOD\_US;}
\DoxyCodeLine{00166\ }
\DoxyCodeLine{00167\ \ \ \ \ \textcolor{comment}{//\ Configuration}}
\DoxyCodeLine{00168\ \ \ \ \ \textcolor{keywordtype}{int}\ has\_output\ =\ 0;\ \textcolor{comment}{//1\ if\ channel\ has\ an\ output\ port,\ otherwise\ 0.}}
\DoxyCodeLine{00169\ \ \ \ \ \mbox{\hyperlink{class_output_port}{OutputPort}}*\ target\_output\_port;\ \textcolor{comment}{//stores\ the\ target\ output\ port}}
\DoxyCodeLine{00170\ \ \ \ \ uint8\_t\ output\_signal\ =\ SIGNAL\_X;\ \textcolor{comment}{//default\ to\ signal\ X}}
\DoxyCodeLine{00171\ \ \ \ \ uint8\_t\ output\_inverted\ =\ 0;\ \textcolor{comment}{//if\ 1,\ will\ invert\ the\ output\ direction\ of\ the\ channel}}
\DoxyCodeLine{00172\ }
\DoxyCodeLine{00173\ \ \ \ \ \textcolor{comment}{//\ Private\ State}}
\DoxyCodeLine{00174\ \ \ \ \ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{float}\ accumulator;}
\DoxyCodeLine{00175\ \ \ \ \ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{float}\ accumulator\_velocity;}
\DoxyCodeLine{00176\ \ \ \ \ \textcolor{keyword}{volatile}\ \textcolor{keywordtype}{int}\ last\_direction;}
\DoxyCodeLine{00177\ \ \ \ \ DecimalPosition\ upper\_limit;}
\DoxyCodeLine{00178\ \ \ \ \ DecimalPosition\ lower\_limit;}
\DoxyCodeLine{00179\ \ \ \ \ \textcolor{keywordtype}{bool}\ upper\_limit\_enabled\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00180\ \ \ \ \ \textcolor{keywordtype}{bool}\ lower\_limit\_enabled\ =\ \textcolor{keyword}{false};}
\DoxyCodeLine{00181\ \ \ \ \ \textcolor{keywordtype}{bool}\ enabled\ =\ \textcolor{keyword}{true};}
\DoxyCodeLine{00182\ }
\DoxyCodeLine{00183\ \ \ \ \ \textcolor{comment}{//\ Private\ Methods}}
\DoxyCodeLine{00184\ \ \ \ \ \textcolor{keywordtype}{void}\ initialize\_state();\ \textcolor{comment}{//\ initializes\ all\ state\ variables}}
\DoxyCodeLine{00185\ \ \ \ \ \textcolor{keywordtype}{void}\ register\_channel();\ \textcolor{comment}{//\ registers\ channel\ with\ the\ signal\ generator\ loop}}
\DoxyCodeLine{00186\ \ \ \ \ \textcolor{keywordtype}{void}\ pulse(int8\_t\ direction);\ \textcolor{comment}{//\ generates\ a\ step\ pulse\ and\ releases\ a\ signal\ on\ the\ output\ port}}
\DoxyCodeLine{00187\ \ }
\DoxyCodeLine{00188\ \};}
\DoxyCodeLine{00189\ }
\DoxyCodeLine{00190\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
